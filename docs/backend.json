{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the GoAlong application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number."
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "isDriver": {
          "type": "boolean",
          "description": "Indicates whether the user is a driver."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phoneNumber",
        "isDriver"
      ]
    },
    "Route": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Route",
      "type": "object",
      "description": "Represents a driver's commute route.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Route entity."
        },
        "driverId": {
          "type": "string",
          "description": "Reference to UserProfile (driver). (Relationship: UserProfile 1:N Route)"
        },
        "startPoint": {
          "type": "string",
          "description": "Starting location of the route (e.g., address or coordinates)."
        },
        "endPoint": {
          "type": "string",
          "description": "Ending location of the route (e.g., address or coordinates)."
        },
        "travelTime": {
          "type": "string",
          "description": "Time of travel for the route (e.g., '8:00 AM')."
        },
        "availableSeats": {
          "type": "number",
          "description": "Number of available seats in the driver's vehicle."
        },
        "routeDays": {
          "type": "array",
          "description": "The days of the week that this route is active",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "driverId",
        "startPoint",
        "endPoint",
        "travelTime",
        "availableSeats"
      ]
    },
    "RideRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RideRequest",
      "type": "object",
      "description": "Represents a rider's request for a ride.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RideRequest entity."
        },
        "riderId": {
          "type": "string",
          "description": "Reference to UserProfile (rider). (Relationship: UserProfile 1:N RideRequest)"
        },
        "pickupLocation": {
          "type": "string",
          "description": "Pickup location specified by the rider."
        },
        "dropoffLocation": {
          "type": "string",
          "description": "Drop-off location specified by the rider."
        },
        "desiredTime": {
          "type": "string",
          "description": "Desired time for the ride."
        },
        "routeId": {
          "type": "string",
          "description": "Reference to Route. (Relationship: Route 1:N RideRequest)"
        }
      },
      "required": [
        "id",
        "riderId",
        "pickupLocation",
        "dropoffLocation",
        "desiredTime"
      ]
    },
    "DeliveryRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DeliveryRequest",
      "type": "object",
      "description": "Represents a sender's request for a delivery.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DeliveryRequest entity."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to UserProfile (sender). (Relationship: UserProfile 1:N DeliveryRequest)"
        },
        "pickupLocation": {
          "type": "string",
          "description": "Pickup location for the delivery."
        },
        "dropoffLocation": {
          "type": "string",
          "description": "Drop-off location for the delivery."
        },
        "desiredTime": {
          "type": "string",
          "description": "Desired time for the delivery."
        },
        "packageDetails": {
          "type": "string",
          "description": "Details about the package being delivered (e.g., size, weight)."
        },
        "routeId": {
          "type": "string",
          "description": "Reference to Route. (Relationship: Route 1:N DeliveryRequest)"
        }
      },
      "required": [
        "id",
        "senderId",
        "pickupLocation",
        "dropoffLocation",
        "desiredTime",
        "packageDetails"
      ]
    },
    "BookingConfirmation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BookingConfirmation",
      "type": "object",
      "description": "Represents a confirmed ride or delivery booking.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the BookingConfirmation entity."
        },
        "rideRequestId": {
          "type": "string",
          "description": "Reference to RideRequest. (Relationship: RideRequest 1:1 BookingConfirmation)"
        },
        "deliveryRequestId": {
          "type": "string",
          "description": "Reference to DeliveryRequest. (Relationship: DeliveryRequest 1:1 BookingConfirmation)"
        },
        "driverId": {
          "type": "string",
          "description": "Reference to UserProfile (driver). (Relationship: UserProfile 1:N BookingConfirmation)"
        },
        "estimatedCost": {
          "type": "number",
          "description": "Estimated cost of the ride or delivery."
        },
        "confirmationTime": {
          "type": "string",
          "description": "Time the booking was confirmed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "driverId",
        "estimatedCost",
        "confirmationTime"
      ]
    },
    "UserFeedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserFeedback",
      "type": "object",
      "description": "Represents user feedback for a driver.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserFeedback entity."
        },
        "driverId": {
          "type": "string",
          "description": "Reference to UserProfile (driver). (Relationship: UserProfile 1:N UserFeedback)"
        },
        "bookingConfirmationId": {
          "type": "string",
          "description": "Reference to BookingConfirmation. (Relationship: BookingConfirmation 1:N UserFeedback)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the user (e.g., 1-5 stars)."
        },
        "comment": {
          "type": "string",
          "description": "Optional comment provided by the user."
        },
        "feedbackTime": {
          "type": "string",
          "description": "Time the feedback was given.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "driverId",
        "bookingConfirmationId",
        "rating"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/userProfiles/{userProfileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Accessible by the user themselves.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The unique identifier for the user's profile."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/routes/{routeId}",
        "definition": {
          "entityName": "Route",
          "schema": {
            "$ref": "#/backend/entities/Route"
          },
          "description": "Stores routes created by drivers. Only accessible by the driver who created the route.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (driver)."
            },
            {
              "name": "routeId",
              "description": "The unique identifier for the route."
            }
          ]
        }
      },
      {
        "path": "/rideRequests/{rideRequestId}",
        "definition": {
          "entityName": "RideRequest",
          "schema": {
            "$ref": "#/backend/entities/RideRequest"
          },
          "description": "Stores ride requests.  Includes denormalized data from routes and user profiles for authorization independence.",
          "params": [
            {
              "name": "rideRequestId",
              "description": "The unique identifier for the ride request."
            }
          ]
        }
      },
      {
        "path": "/deliveryRequests/{deliveryRequestId}",
        "definition": {
          "entityName": "DeliveryRequest",
          "schema": {
            "$ref": "#/backend/entities/DeliveryRequest"
          },
          "description": "Stores delivery requests. Includes denormalized data from routes and user profiles for authorization independence.",
          "params": [
            {
              "name": "deliveryRequestId",
              "description": "The unique identifier for the delivery request."
            }
          ]
        }
      },
      {
        "path": "/bookingConfirmations/{bookingConfirmationId}",
        "definition": {
          "entityName": "BookingConfirmation",
          "schema": {
            "$ref": "#/backend/entities/BookingConfirmation"
          },
          "description": "Stores booking confirmations. Includes denormalized data from ride/delivery requests and user profiles for authorization independence.",
          "params": [
            {
              "name": "bookingConfirmationId",
              "description": "The unique identifier for the booking confirmation."
            }
          ]
        }
      },
      {
        "path": "/userFeedback/{userFeedbackId}",
        "definition": {
          "entityName": "UserFeedback",
          "schema": {
            "$ref": "#/backend/entities/UserFeedback"
          },
          "description": "Stores user feedback for drivers. Only accessible to admins or the driver receiving the feedback.",
          "params": [
            {
              "name": "userFeedbackId",
              "description": "The unique identifier for the user feedback."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the GoAlong application's core features, emphasizing security, scalability, and ease of debugging. It follows the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters).\n\n*   **Authorization Independence:** Achieved through denormalization.  For example, any information needed to authorize access to `RideRequest` documents based on the associated `Route` is denormalized into the `RideRequest` document itself, avoiding `get()` calls in security rules. Similarly, information needed to access `BookingConfirmation` documents based on the associated `RideRequest` and `Route` is denormalized into the `BookingConfirmation` document.\n*   **Clarity of Intent:** Each collection is dedicated to a specific entity, making the purpose of each document clear.  The path structure also reflects the relationships between entities, such as the user-owned `Route` and related `RideRequest` and `DeliveryRequest`.\n*   **DBAC:** Roles are not stored in custom claims. Access control relies solely on `request.auth.uid` and data within the documents.\n*   **QAPs:** Supported by segregating data with different access requirements into separate collections. For user-specific data (e.g., routes), path-based ownership (`/users/{userId}/routes/{routeId}`) ensures that listing operations are secure and efficient, without the need for filtering.\n\nThe data structure uses hierarchical paths for user-owned data to simplify security rules and enforce ownership.  For example, routes are stored under `/users/{userId}/routes/{routeId}` to easily secure access to routes owned by a specific user. Ride and delivery requests are stored in collections at the root level because they are shared resources that need to be querieable, using the membership model (`members: {uid: role}`) for authorization as necessary. The booking confirmation has a path that facilitates easy access and linking to ride and delivery requests.\n\nThis structure ensures that security rules are simple, robust, and easily debuggable by avoiding hierarchical authorization dependencies and leveraging path-based ownership where appropriate."
  }
}